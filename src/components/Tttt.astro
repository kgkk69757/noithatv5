---
import "../css/Tttt.css";
import type { VideoItem, TikTokItem } from "../lib/types/index";
import { 
  fetchMediaContents, 
  convertToVideoItems, 
  convertToTikTokItems 
} from "../lib/api/index";

// Fetch data from API
const mediaData = await fetchMediaContents();

// Convert to legacy format or use fallback data
let videoItems: VideoItem[] = [];
let tiktokItems: TikTokItem[] = [];

if (mediaData?.success) {
  videoItems = convertToVideoItems(mediaData.data.video_section);
  tiktokItems = convertToTikTokItems(mediaData.data.tiktok_section);
} else {
  // Fallback data
  videoItems = [
    {
      id: 'youtube-1',
      title: 'Video YouTube Demo',
      media_id: 'eFIMruzx_Rs',
      is_youtube: true,
      embed_code: '<iframe width="560" height="315" src="https://www.youtube.com/embed/eFIMruzx_Rs" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>'
    }
  ];
  
  tiktokItems = [
    {
      id: 'tiktok-1',
      title: 'TikTok Demo',
      media_id: '7513901363470945554',
      is_youtube: false,
      thumbnail: 'https://p16-sign-sg.tiktokcdn.com/obj/tos-alisg-p-0037/example',
      embed_url: 'https://www.tiktok.com/embed/video/7513901363470945554'
    }
  ];
}
---

<section>
  <div class="media-container">
    <h1 class="media-slider-title">KÊNH TRUYỀN THÔNG TRỰC TUYẾN</h1>

    <!-- Horizontal Video List -->
    <div class="media-video-container">
      <div class="media-video-list" id="videoSlider">
        {videoItems.map((item, index) => (
          <div class="video-item">
            <iframe
              src={`https://www.youtube.com/embed/${item.media_id}`}
              title={item.title}
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen></iframe>
          </div>
        ))}
      </div>
    </div>

    <!-- TikTok Section -->
    <h1 class="media-slider-title media-tiktok-title">TikTok</h1>

    <div class="media-tiktok-container">
      <div class="media-tiktok-list" id="tiktokSlider">
        {tiktokItems.map((item, index) => (
          <div class="tiktok-item">
            <blockquote
              class="tiktok-embed"
              cite={item.embed_url}
              data-video-id={item.media_id}
              style="max-width: 605px;min-width: 325px;"
            >
              <section>
                <a
                  target="_blank"
                  title="@deco.home86"
                  href="https://www.tiktok.com/@deco.home86?refer=embed"
                  >@deco.home86
                  </a>
                {item.title}
              </section>
            </blockquote>
          </div>
        ))}
      </div>
    </div>
  </div>
</section>

<!-- External JS -->
<script src="/js/Tttt.js" defer></script>
<script src="https://www.tiktok.com/embed.js" defer></script>

